<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WRUS Portal</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/inventory-summary.css" />
</head>
<body>
  <div class="d-flex flex-column flex-md-row" id="wrapper">
    <div id="sidebarContainer"></div>
    <!-- Page Content -->
    <div class="container-fluid p-2" id="page-content">
      <h2 class="file-tab-heading">Ledger/ICS Summary</h2>
      <!-- Nav tabs -->
      <ul class="nav nav-tabs mb-3" id="summaryTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="chart-tab"
            data-bs-toggle="tab"
            data-bs-target="#chartTab"
            type="button"
            role="tab"
            aria-controls="chartTab"
            aria-selected="true"
          >
            Ledger Report
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="table-tab"
            data-bs-toggle="tab"
            data-bs-target="#tableTab"
            type="button"
            role="tab"
            aria-controls="tableTab"
            aria-selected="false"
          >
            Inventory Summary
          </button>
        </li>
      </ul>

      <!-- Tab contents -->
      <div class="tab-content" id="summaryTabsContent">

        <!-- Ledger Report Tab -->
        <div
          class="tab-pane fade show active"
          id="chartTab"
          role="tabpanel"
          aria-labelledby="chart-tab"
        >
        <!-- Latest Ledger Report -->
        <div class="card mb-4 shadow-sm">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Latest Ledger Report</h5>
          </div>
          <div class="card-body">
            <div id="ledgerContainer"></div>
          </div>
        </div>

        <!-- Priority Items Analytics -->
        <div class="card mb-4 shadow-sm">
          <div class="card-header bg-success text-dark">
            <h5 class="mb-0">Consumable Item Analytics (Priority Items Only)</h5>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover table-striped table-bordered mb-0">
                <thead class="table-dark">
                  <tr>
                    <th>CID</th>
                    <th>Specification</th>
                    <th>Unit</th>
                    <th>Stock</th>
                    <th>Consumed (12 mo)</th>
                    <th>Lifespan</th>
                    <th>Avg/Month</th>
                    <th>Days Left</th>
                    <th>Resupply?</th>
                  </tr>
                </thead>
                <tbody id="priorityBody"></tbody>
                <tfoot class="table-light">
                  <tr>
                    <td colspan="9" class="text-muted small">
                      <strong>Notes:</strong>  
                      <ul class="mb-0 ps-3">
                        <li><strong>Consumed (12 mo)</strong> = total quantity used in the past rolling 12 months.</li>
                        <li><strong>Lifespan</strong> = estimated from usage rates and current stock.</li>
                        <li><strong>Avg/Month</strong> = Consumed (12 mo) ÷ 12 months.</li>
                        <li><strong>Days Left</strong> = stock ÷ average daily consumption.</li>
                        <li><strong>Resupply?</strong> flags items projected to run out within a year.</li>
                      </ul>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>

        <!-- Critically Low Supplies -->
        <div class="card shadow-sm">
          <div class="card-header bg-danger text-white">
            <h5 class="mb-0">Critically Low Consumable Supplies</h5>
          </div>
          <div class="card-body">
            <div id="lowSupplyChartContainer"></div>
          </div>
        </div>
          
        </div>

        <!-- Inventory Summary Tab -->
        <div
          class="tab-pane fade"
          id="tableTab"
          role="tabpanel"
          aria-labelledby="table-tab"
        >
          <div class="table-responsive shadow-sm rounded bg-white p-3" style="height: auto; overflow-y: visible;">
            <!-- Search Bar -->
            <div class="d-flex justify-content-between align-items-center mb-4">
              <input
                type="text"
                id="searchInput"
                class="form-control w-50"
                placeholder="Search by name..."
              />
            </div>

            <table class="table table-striped">
              <thead class="table-primary text-center">
                <tr>
                  <th>Name</th>
                  <th>Consumable</th>
                  <th>ICS</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <!-- JavaScript will inject rows here -->
              </tbody>
            </table>
            
            <!-- Pagination container - insert your pagination here -->
            <nav id="paginationNav" aria-label="Page navigation" class="mt-3"></nav>
            
          </div>
        </div>

      </div>

      <!-- Consumable Modal-->
      <div
        class="modal fade"
        id="consumableModal"
        tabindex="-1"
        aria-labelledby="consumableModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header bg-info">
              <h5 class="modal-title text-white" id="consumableModalLabel">Consumable Details</h5>
              <button
                type="button"
                class="btn-close btn-3d"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <p class="text-center">Loading…</p>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-3d btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ICS Items User Modal-->
      <div class="modal fade" id="propertyModal" tabindex="-1" aria-labelledby="propertyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
          <div class="modal-content shadow-lg rounded-3 small">
            
            <!-- Modal Header -->
            <div class="modal-header bg-info flex-wrap gap-3 justify-content-between align-items-center border-bottom-0 px-4 pt-4 pb-2">
              <div>
                <h5 class="modal-title fw-semibold text-primary" id="propertyModalLabel">
                  Property Accountability of <span id="fullName" class="text-white"></span>
                </h5>
              </div>
              <div class="d-flex flex-column align-items-end">
                <button type="button" class="btn-close btn-3d mb-2" data-bs-dismiss="modal" aria-label="Close"></button>
                <strong>Total Amount: <span id="totalAmount" class="text-dark"></span></strong>
              </div>
            </div>

            <!-- Modal Body -->
            <div class="modal-body px-4 pt-2 pb-0 d-flex flex-column" style="gap: 0.5rem;">
              <div id="scrollableTableWrapper" style="flex: 1; overflow-x: auto; overflow-y: auto;">
                <div style="min-width: 1000px;">
                  <table class="table table-bordered table-sm align-middle text-center mb-0 property-accountability-table">
                    <thead class="table-light text-nowrap">
                      <tr>
                        <th rowspan="2">Qty</th>
                        <th rowspan="2">UoM</th>
                        <th rowspan="2">Description</th>
                        <th rowspan="2">SN</th>
                        <th colspan="2">Amount</th>
                        <th rowspan="2">ICS No</th>
                        <th rowspan="2">Date Issued</th>
                        <th rowspan="2">Remarks</th>
                        <th rowspan="2">PDF</th>
                      </tr>
                      <tr>
                        <th>Unit Cost</th>
                        <th>Total Cost</th>
                      </tr>
                    </thead>
                    <tbody id="icsTableBody">
                      <!-- ICS data rows go here dynamically -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer justify-content-between align-items-center px-4 border-top-0 pb-4">
              <button id="generatePdfBtn" class="btn btn-3d btn-outline-danger" data-userid="USER_ID_HERE">
                <i class="bi bi-file-earmark-pdf me-1"></i> Generate PDF
              </button>
              <div></div>
            </div>

          </div>
        </div>
      </div>

      <!-- ICS PDF Viewer Modal -->
      <div class="modal fade" id="ICS-pdfModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen modal-dialog-centered modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">ICS PDF Report</h5>
              <button type="button" class="btn-close btn-3d" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <!-- PDF content will be injected here -->
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  ></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Chart.js datalabels plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script type="module" src="js/summary/summary-init.js"></script>
</body>
</html>